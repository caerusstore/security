<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Ticket Milestones</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
</head>
<body>
<div class="container mt-4">
    <h2 th:text="'Ticket: ' + ${ticket.title}"></h2>
    <div id="timeline" class="d-flex justify-content-between mt-4">
        <div th:each="milestone,iterStat : ${ticket.milestones}" 
             th:class="'p-2 flex-fill text-center ' + (${iterStat.index} == ${ticket.currentIndex} ? 'bg-success text-white' : (${iterStat.index} < ${ticket.currentIndex} ? 'bg-secondary text-white' : 'bg-light'))">
            <span th:text="${milestone}"></span>
        </div>
    </div>
    <p class="mt-3" id="countdown"></p>
</div>

<script>
    const eventSource = new EventSource('/tickets/stream/1');
    eventSource.onmessage = function(event) {
        const ticket = JSON.parse(event.data);
        let html = '';
        for (let i = 0; i < ticket.milestones.length; i++) {
            if (i < ticket.currentIndex) {
                html += `<div class='p-2 flex-fill text-center bg-secondary text-white'>${ticket.milestones[i]}</div>`;
            } else if (i === ticket.currentIndex) {
                html += `<div class='p-2 flex-fill text-center bg-success text-white'>${ticket.milestones[i]}</div>`;
            } else {
                html += `<div class='p-2 flex-fill text-center bg-light'>${ticket.milestones[i]}</div>`;
            }
        }
        document.getElementById('timeline').innerHTML = html;
    };
</script>
</body>
</html>
